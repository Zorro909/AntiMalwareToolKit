package optic_fusion1.antimalwaretoolkit;

import java.util.Arrays;
import java.util.HashMap;
import java.util.Scanner;
import optic_fusion1.antimalwaretoolkit.tool.Tool;
import optic_fusion1.antimalwaretoolkit.tool.impl.ChangeAccess;
import optic_fusion1.antimalwaretoolkit.tool.impl.Cleanup;
import optic_fusion1.antimalwaretoolkit.tool.impl.CleanupInvalidFiles;
import optic_fusion1.antimalwaretoolkit.tool.impl.DatabaseMigration;
import optic_fusion1.antimalwaretoolkit.tool.impl.ListFiles;
import optic_fusion1.antimalwaretoolkit.tool.impl.MethodNamePrinter;
import optic_fusion1.antimalwaretoolkit.tool.impl.PluginAnalyzer;
import optic_fusion1.antimalwaretoolkit.tool.impl.SortJars;
import optic_fusion1.antimalwaretoolkit.tool.impl.SpigotPluginDownloader;
import optic_fusion1.antimalwaretoolkit.tool.impl.StringPrinter;
import optic_fusion1.antimalwaretoolkit.tool.impl.UpdateDatabase;
import org.apache.commons.text.StringTokenizer;
import org.apache.commons.text.matcher.StringMatcherFactory;

public class Main {

  private HashMap<String, Tool> tools = new HashMap<>();
  private boolean isRunning;
  private Scanner scanner = new Scanner(System.in);

  public static void main(String[] args) {
    new Main().main();
  }

  private void addTools() {
	tools.put("methodnameprinter", new MethodNamePrinter());
	tools.put("changeaccess", new ChangeAccess());
	tools.put("stringprinter", new StringPrinter());
	tools.put("cleanupinvalidfiles", new CleanupInvalidFiles());
	tools.put("cleanup", new Cleanup());
	tools.put("updatedatabase", new UpdateDatabase());
	tools.put("spigotplugindownloader", new SpigotPluginDownloader());
	tools.put("listfiles", new ListFiles());
	tools.put("sortjars", new SortJars());
	tools.put("pluginanalyzer", new PluginAnalyzer());
	tools.put("databasemigration", new DatabaseMigration());
  }

  private void main() {
    isRunning = true;
    addTools();
    System.out.println("Finished loading, run a tool");
    while (isRunning) {
      StringTokenizer st = new StringTokenizer(scanner.nextLine());
      st.setQuoteMatcher(StringMatcherFactory.INSTANCE.quoteMatcher());
      String[] args = st.getTokenArray();
      if (args.length == 0) {
        System.out.println("args.length is 0");
        continue;
      }
      Tool tool = tools.get(args[0]);
      if (tool == null) {
        System.out.println(args[0] + " is not a valid tool");
        continue;
      }
      if (args.length == 2 && args[1].equals("?")) {
        System.out.println(tool.getDescription());
      }
      tool.run(Arrays.copyOfRange(args, 1, args.length));
    }
  }

}
